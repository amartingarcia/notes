<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Adrián Martín García" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Helmfile - MyNotes</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Helmfile";
        var mkdocs_page_input_path = "kubernetes/helm/helmfile.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/dockerfile.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/groovy.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> MyNotes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
    <ul>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CI/CD</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Jenkins</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../cicd/jenkins/jenkins/">Jenkins</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Jenkinsfile</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfile/">Jenkinsfiles</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfiles/jenkinsfile_1/">Example 1</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfiles/jenkinsfile_2/">Example 2</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfiles/jenkinsfile_3/">Example 3</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfiles/jenkinsfile_4/">Example 4</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../cicd/jenkins/jenkinsfiles/jenkinsfile_5/">Example 5</a>
    <ul>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Git</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../git/multi_accounts/">Multi-accounts</a>
    <ul>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Kubernetes</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">Certifications</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../certifications/cka/">CKA</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../certifications/ckad.md">CKAD</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../certifications/cks/">CKS</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Helm</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../helm/">Helm</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../helm/#helm-charts">Helm Charts</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../helm/#directory-hierarchy">Directory hierarchy</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../helm-docs/">helm-docs</a>
    <ul>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Helmfile</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#hierarchy">Hierarchy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example-files">Example files</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#basesenvironmentsyaml">bases/environments.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#baseshelmdefaultsyaml">bases/helmDefaults.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#templatessopsyaml">templates/.sops.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#templatesdefault_valuesyaml">templates/default_values.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#helmfileyaml">helmfile.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#releasesmetrics-serverhelmfileyaml">releases/metrics-server/helmfile.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#releasesmetrics-serverdefaultsyaml">releases/metrics-server/defaults.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#releasesmetrics-serverenvsdevvaluesyaml">releases/metrics-server/envs/dev/values.yaml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#releasesmetrics-serverenvsdevvaluesyamlgtmpl">releases/metrics-server/envs/dev/values.yaml.gtmpl</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#hemfile-commands">Hemfile Commands</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#rendering-dev-environment">Rendering dev environment</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#rendering-dev-environment-for-metrics-server">Rendering dev environment for metrics-server</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#diff-shows-differences-between-the-code-and-the-cluster">Diff. Shows differences between the code and the cluster</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#sync-install-metrics-server-release">Sync (Install) metrics-server release</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#delete-metrics-server-release">Delete metrics-server release</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sops/">SOPS</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../sops/#sops-commands">SOPS Commands</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../sops/#show-file">Show file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../sops/#encrypt-file">Encrypt file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../sops/#decrypt-file">Decrypt file</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../helmwave/">Helmwave</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../kops/">kOps</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../kops/#example-file">Example file</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">QA</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../qa/semantic_release/">Semantic Release</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../../qa/semantic_release/#how-semantic-selease-works">How Semantic Selease works</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../qa/nexus/">Nexus</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../qa/sonarqube/">Sonarqube</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Keycloak</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../security/keycloak/">Keycloak</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak/#installation">Installation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak/#login">Login</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak/#configure-microsoft-azure-as-identity-provider">Configure Microsoft Azure as Identity Provider</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak/#app-registration">App Registration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak/#keycloak-indentity-provider">Keycloak Indentity Provider</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../security/keycloak_jenkins/">Jenkins</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_jenkins/#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_jenkins/#configuration">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_jenkins/#keycloak">Keycloak</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_jenkins/#jenkins_1">Jenkins</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_jenkins/#login">Login</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../security/keycloak_nexus/">Nexus</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_nexus/#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_nexus/#configuration">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_nexus/#keycloak">Keycloak</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_nexus/#nexus_1">Nexus</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_nexus/#login">Login</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../security/keycloak_sonarqube/">Sonarqube</a>
    <ul>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_sonarqube/#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_sonarqube/#configuration">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_sonarqube/#keycloak">Keycloak</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="../../../security/keycloak_sonarqube/#sonarqube_1">Sonarqube</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../../../security/keycloak_sonarqube/#login">Login</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">MyNotes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Kubernetes &raquo;</li>
          <li>Helm &raquo;</li>
      <li>Helmfile</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/amartingarcia/notes/edit/master/docs/kubernetes/helm/helmfile.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="helmfile">Helmfile<a class="headerlink" href="#helmfile" title="Permanent link">&para;</a></h1>
<p>Helmfile is a Helm wrapper that allows to manage multiple Helm Charts in a simpler way.</p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>Helmfile</li>
<li>Helm</li>
<li>Helm-diff</li>
<li>Helm-secrets</li>
<li>SOPS  By default <code>export HELM_SECRETS_BACKEND=sops</code>.</li>
<li>VALS <code>export HELM_SECRETS_BACKEND=vals</code>.</li>
</ul>
<h2 id="hierarchy">Hierarchy<a class="headerlink" href="#hierarchy" title="Permanent link">&para;</a></h2>
<pre><code>.
├── bases
│   ├── environments.yaml ------------------------------------------&gt;   (Environments are defined. And versions are declared for the official Helm Charts)
│   └── helmDefaults.yaml ------------------------------------------&gt;   (Default values of the Helm deployment. For example: wait or timeout)
├── helmfile.yaml --------------------------------------------------&gt;   (Main helmfile.yaml file)
├── releases -------------------------------------------------------&gt;   (Directory to locate all releases)
│   └── my-release
│       ├── defaults.yaml ------------------------------------------&gt;   (Set default values for the release)
│       ├── envs ---------------------------------------------------&gt;   (Environment directory)
│       │   ├── dev
│       │   │   ├── aws-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from AWS)
│       │   │   ├── az-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Azure)
│       │   │   ├── gcp-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from GCP)
│       │   │   ├── hc-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Hashicorp Vault)
│       │   │   ├── az-local-secret-values.yaml --------------------&gt;   (Optional. File with values encrypted locally with SOPS)
│       │   │   ├── .sops.yaml -&gt; ../../../../templates/.sops.yaml -&gt;   (Symbolic link to .sops.yaml file)
│       │   │   ├── values.yaml.gotmpl -----------------------------&gt;   (Environment value using gotmpl)
│       │   │   └── values.yaml ------------------------------------&gt;   (environment value file)
│       │   ├── pre
│       │   │   ├── aws-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from AWS)
│       │   │   ├── az-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Azure)
│       │   │   ├── gcp-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from GCP)
│       │   │   ├── hc-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Hashicorp Vault)
│       │   │   ├── az-local-secret-values.yaml --------------------&gt;   (Optional. File with values encrypted locally with SOPS)
│       │   │   ├── .sops.yaml -&gt; ../../../../templates/.sops.yaml -&gt;   (Symbolic link to .sops.yaml file)
│       │   │   ├── values.yaml.gotmpl -----------------------------&gt;   (Environment value using gotmpl)
│       │   │   └── values.yaml ------------------------------------&gt;   (environment value file)
│       │   └── pro
│       │       ├── aws-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from AWS)
│       │       ├── az-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Azure)
│       │       ├── gcp-remote-secret-values.yaml ------------------&gt;   (Optional. File with reference to remote encrypted values from GCP)
│       │       ├── hc-remote-secret-values.yaml -------------------&gt;   (Optional. File with reference to remote encrypted values from Hashicorp Vault)
│       │       ├── az-local-secret-values.yaml --------------------&gt;   (Optional. File with values encrypted locally with SOPS)
│       │       ├── .sops.yaml -&gt; ../../../../templates/.sops.yaml -&gt;   (Symbolic link to .sops.yaml file)
│       │       ├── values.yaml.gotmpl -----------------------------&gt;   (Environment value using gotmpl)
│       │       └── values.yaml ------------------------------------&gt;   (Environment value file)
│       └── helmfile.yaml ------------------------------------------&gt;   (Helmfile.yaml release file)
└── templates ------------------------------------------------------&gt;   (Template directory)
    ├── default_values.yaml ----------------------------------------&gt;   (File with declared YAML Anchors that allow parameterizing the access to the value files)
    └── .sops.yaml -------------------------------------------------&gt;   (File with SOPS encryption rules)
</code></pre>
<h2 id="example-files">Example files<a class="headerlink" href="#example-files" title="Permanent link">&para;</a></h2>
<h3 id="basesenvironmentsyaml">bases/environments.yaml<a class="headerlink" href="#basesenvironmentsyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">---
templates:
  default_releases: &amp;default_releases
    values:
    - metrics-server: 3.8.2
    - reloader: 0.0.118

environments:
  dev:
    values:
    &lt;&lt;: *default_releases
  pre:
    values:
    &lt;&lt;: *default_releases
  pro:
    values:
    &lt;&lt;: *default_releases
</code></pre>
<h3 id="baseshelmdefaultsyaml">bases/helmDefaults.yaml<a class="headerlink" href="#baseshelmdefaultsyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">---
# If set to &quot;Error&quot;, return an error when a subhelmfile points to a
# non-existent path. The default behavior is to print a warning and continue.
missingFileHandler: Error

# these labels will be applied to all releases in a Helmfile. Useful in templating if you have a helmfile per environment or customer and don't want to copy the same label to each release
commonLabels:
  provisioning: helmfile

# Default values to set for args along with dedicated keys that can be set by contributors, cli args take precedence over these.
# In other words, unset values results in no flags passed to helm.
# See the helm usage (helm SUBCOMMAND -h) for more info on default values when those flags aren't provided.
helmDefaults:
  # wait for k8s resources via --wait. (default false)
  wait: false
  # if set and --wait enabled, will wait until all Jobs have been completed before marking the release as successful. It will wait for as long as --timeout (default false, Implemented in Helm3.5)
  waitForJobs: false
  # time in seconds to wait for any individual Kubernetes operation (like Jobs for hooks, and waits on pod/pvc/svc/deployment readiness) (default 300)
  timeout: 600
  # verify the chart before upgrading (only works with packaged charts not directories) (default false)
  verify: false
  # forces resource update through delete/recreate if needed (default false)
  force: false
  ## enable TLS for request to Tiller (default false)
  #tls: true
  ## path to TLS CA certificate file (default &quot;$HELM_HOME/ca.pem&quot;)
  #tlsCACert: &quot;path/to/ca.pem&quot;
  ## path to TLS certificate file (default &quot;$HELM_HOME/cert.pem&quot;)
  #tlsCert: &quot;path/to/cert.pem&quot;
  ## path to TLS key file (default &quot;$HELM_HOME/key.pem&quot;)
  #tlsKey: &quot;path/to/key.pem&quot;
  # limit the maximum number of revisions saved per release. Use 0 for no limit. (default 10)
  historyMax: 10
  # when using helm 3.2+, automatically create release namespaces if they do not exist (default true)
  createNamespace: true
  # if used with charts museum allows to pull unstable charts for deployment, for example: if 1.2.3 and 1.2.4-dev versions exist and set to true, 1.2.4-dev will be pulled (default false)
  devel: false
  # When set to `true`, skips running `helm dep up` and `helm dep build` on this release's chart.
  # Useful when the chart is broken, like seen in https://github.com/roboll/helmfile/issues/1547
  #skipDeps: false
</code></pre>
<h3 id="templatessopsyaml">templates/.sops.yaml<a class="headerlink" href="#templatessopsyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">creation_rules:
    # PGP
    - path_regex: pgp-local.*.yaml$
      pgp: B911C4BA2C10BF8BA1D9D005A680D32C9AE9B9CB
    # HC Vault
    - path_regex: hc-local-.*.yaml$
      vault_path: &quot;sops/&quot;
      vault_kv_mount_name: &quot;secret/&quot;
      vault_kv_version: 2
    # GCP KMS
    - path_regex: gcp-local-.*.yaml$
      gcp_kms: projects/mygcproject/locations/global/keyRings/mykeyring/cryptoKeys/thekey 
    # AWS KMS
    - path_regex: aws-local-.*.yaml$
      kms: 'arn:aws:kms:us-west-2:0000000000000:key/fe86dd69-4132-404c-ab86-4269956b4500'
    # AZ Key Vault
    - path_regex: az-local-.*.yaml$
      azure_keyvault: https://test.vault.azure.net/keys/sops/7b7c6b92999b42e79d744a0d4dc23e4adf

</code></pre>
<h3 id="templatesdefault_valuesyaml">templates/default_values.yaml<a class="headerlink" href="#templatesdefault_valuesyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">---
templates:
  # Labels
  any_enc_labels: &amp;any_enc_labels
    labels:
      enc: any

  sops_enc_labels: &amp;sops_enc_labels
    labels:
      enc: sops

  vals_enc_labels: &amp;vals_enc_labels
    labels:
      enc: vals

  # Values files
  default_values: &amp;default_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml

  gotmpl_values: &amp;gotmpl_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml.gotmpl

  remote_values: &amp;remote_values
    values:
    - defaults.yaml
    - git::https://user:{{ env &quot;CI_JOB_TOKEN&quot; }}@git.company.com/demo/helmfiles/{{ .Environment.Name }}/values.yaml?ref=master
    - http://$HOSTNAME/artifactory/example-repo-local/test.tgz@values.yaml

  # Secrets on values files
  ## Local `SOPS`
  pgp_local_secret_values: &amp;pgp_local_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/pgp-local-secret-values.yaml

  hc_local_secret_values: &amp;hc_local_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/hc-local-secret-values.yaml

  gcp_local_secret_values: &amp;gcp_local_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/gcp-local-secret-values.yaml

  aws_local_secret_values: &amp;aws_local_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/aws-local-secret-values.yaml

  az_local_secret_values: &amp;az_local_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/az-local-secret-values.yaml

  ## Remote `VALS`
  hc_remote_secret_values: &amp;hc_remote_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/hc-remote-secret-values.yaml

  gcp_remote_secret_values: &amp;gcp_remote_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/gcp-remote-secret-values.yaml

  aws_remote_secret_values: &amp;aws_remote_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/aws-remote-secret-values.yaml

  az_remote_secret_values: &amp;az_remote_secret_values
    values:
    - defaults.yaml
    - envs/{{ .Environment.Name }}/values.yaml
    secrets:
    - envs/{{ .Environment.Name }}/az-remote-secret-values.yaml
</code></pre>
<h3 id="helmfileyaml">helmfile.yaml<a class="headerlink" href="#helmfileyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">---
bases:
- &quot;bases/helmDefaults.yaml&quot;
- &quot;bases/environments.yaml&quot;

repositories:
- name: metrics-server
  url: https://kubernetes-sigs.github.io/metrics-server/
- name: reloader
  url: https://stakater.github.io/stakater-charts

helmfiles:
- &quot;releases/*/helmfile.yaml&quot;
</code></pre>
<h3 id="releasesmetrics-serverhelmfileyaml">releases/metrics-server/helmfile.yaml<a class="headerlink" href="#releasesmetrics-serverhelmfileyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">----
bases:
  - &quot;../../bases/helmDefaults.yaml&quot;
  - &quot;../../bases/environments.yaml&quot;

---
{{ readFile &quot;../../templates/default_values.yaml&quot; }}

releases:
# https://github.com/helm/charts/blob/master/stable/metrics-server/values.yaml
- name: metrics-server
  chart: metrics-server/metrics-server
  namespace: metrics-server
  version: {{ index (.Values | get &quot;metrics-server&quot; &quot;3.7.0&quot;) }}
  &lt;&lt;: *any_enc_labels                                                          # You can use: any_enc_labels, sops_enc_labels or vals_enc_labels
  &lt;&lt;: *gotmpl_values                                                           # Depending on the type of values you need, 
                                                                               # you can use the anchors declared in the defaults_values.yaml file.
                                                                               # Example: default_values, remote_values, gcp_remote_secret_values, gcp_local_secret_values ...
</code></pre>
<h3 id="releasesmetrics-serverdefaultsyaml">releases/metrics-server/defaults.yaml<a class="headerlink" href="#releasesmetrics-serverdefaultsyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml"># Custom values for metrics-server.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
---
args:
# enable this if you have self-signed certificates, see: https://github.com/kubernetes-incubator/metrics-server
  - --kubelet-insecure-tls
</code></pre>
<h3 id="releasesmetrics-serverenvsdevvaluesyaml">releases/metrics-server/envs/dev/values.yaml<a class="headerlink" href="#releasesmetrics-serverenvsdevvaluesyaml" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml"># Custom values to dev environment.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
---
podLabels:
  env: &quot;&quot;
</code></pre>
<h3 id="releasesmetrics-serverenvsdevvaluesyamlgtmpl">releases/metrics-server/envs/dev/values.yaml.gtmpl<a class="headerlink" href="#releasesmetrics-serverenvsdevvaluesyamlgtmpl" title="Permanent link">&para;</a></h3>
<pre><code class="language-go">{{ readFile &quot;values.yaml&quot; | fromYaml | setValueAtPath &quot;podLabels.env&quot; .Environment.Name | toYaml }}
</code></pre>
<h2 id="hemfile-commands">Hemfile Commands<a class="headerlink" href="#hemfile-commands" title="Permanent link">&para;</a></h2>
<h3 id="rendering-dev-environment">Rendering dev environment<a class="headerlink" href="#rendering-dev-environment" title="Permanent link">&para;</a></h3>
<pre><code class="language-sh">$ helmfile template --environment dev
</code></pre>
<h3 id="rendering-dev-environment-for-metrics-server">Rendering dev environment for metrics-server<a class="headerlink" href="#rendering-dev-environment-for-metrics-server" title="Permanent link">&para;</a></h3>
<pre><code class="language-sh">$ helmfile template --environment dev --selector name=metrics-server
</code></pre>
<h3 id="diff-shows-differences-between-the-code-and-the-cluster">Diff. Shows differences between the code and the cluster<a class="headerlink" href="#diff-shows-differences-between-the-code-and-the-cluster" title="Permanent link">&para;</a></h3>
<pre><code class="language-sh">$ helmfile diff --environment dev --selector name=metrics-server
</code></pre>
<h4 id="linters">Linters<a class="headerlink" href="#linters" title="Permanent link">&para;</a></h4>
<pre><code class="language-sh">$ helmfile lint --environment dev
</code></pre>
<h3 id="sync-install-metrics-server-release">Sync (Install) metrics-server release<a class="headerlink" href="#sync-install-metrics-server-release" title="Permanent link">&para;</a></h3>
<pre><code class="language-sh">$ helmfile sync --environment dev --selector name=metrics-server
</code></pre>
<h3 id="delete-metrics-server-release">Delete metrics-server release<a class="headerlink" href="#delete-metrics-server-release" title="Permanent link">&para;</a></h3>
<pre><code class="language-sh">$ helmfile destroy --environment dev --selector name=metrics-server
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../helm-docs/" class="btn btn-neutral float-left" title="helm-docs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../sops/" class="btn btn-neutral float-right" title="SOPS">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/amartingarcia/notes" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../helm-docs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../sops/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
